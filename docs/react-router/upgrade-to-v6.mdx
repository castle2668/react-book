---
sidebar_position: 2
keywords: [React, Router, v6]
---

# Upgrading To React Router v6

React Router ç¬¬ 6 ç‰ˆ

- å°‡ Switch æ›¿æ›æˆ Routes
  - æŠŠ Route ç”¨ Routes åŒ…èµ·ä¾†
  - ä¸å†éœ€è¦ exact å±¬æ€§
- èª¿æ•´ Nested Routes å®šç¾©æ–¹å¼
  - åŠ ä¸Šç±³å­—è™Ÿä¾†é…å°å­å…ƒä»¶ä¸­çš„ Routes
  - å·¢ç‹€è·¯ç”±çš„å­çµ„ä»¶çš„è·¯å¾‘å¯«æ³•
  - é›†ä¸­å®šç¾© Routes æ­é… Outlet Componentï¼Œä¸”ç„¡éœ€ç±³å­—è™Ÿ
- NavLink çš„ activeClassName ç§»é™¤ï¼Œè«‹æ”¹ç”¨ ClassName
- å°‡ Redirect æ›¿æ›æˆ Navigate
- ç§»é™¤ useHistory æ”¹ç”¨ useNavigate åŸ·è¡Œç¨‹å¼åŒ–å°èˆª
- Prompt ç›´æ¥ç§»é™¤ï¼Œæ²’æœ‰æ›¿ä»£æ–¹æ¡ˆ

## å°‡ Switch æ›¿æ›æˆ Routesï¼Œæ”¹ç”¨ element å±¬æ€§æŒ‡å®šæ¸²æŸ“å…ƒä»¶

ç¬¬ä¸€å€‹è®ŠåŒ–ï¼Œå°±æ˜¯ React Router ç‰ˆæœ¬ 6 å°‡åŸæœ¬çš„ `<Switch>` æ›´æ”¹ç‚º `<Routes>`ï¼Œé€™åªæ˜¯å–®ç´”åœ°æ›´æ”¹åå­—ï¼Œç”¨æ³•æ²’æœ‰æ”¹è®Šã€‚  
ä½¿ç”¨ä¸Šï¼Œä¸€æ¨£æ˜¯è¦ç”¨ `<BrowserRouter>` åŒ…ä½ `<App>` ä¾†æŒ‡å®šè¦åœ¨ `<App>` åº•ä¸‹è¦åŠƒè·¯ç”±ã€‚

ä½†æ˜¯è¨»å†Šè·¯ç”±å…ƒä»¶çš„æ–¹å¼å°±ä¸ä¸€æ¨£äº†ï¼ŒåŸå…ˆ V5 æˆ‘å€‘æ˜¯åœ¨ `<Route>` çš„å­å±¤æ”¾å…¥ Page Componentã€‚  
ä½†åˆ°äº† V6ï¼Œå‰‡æ”¹ç”¨ `<Route>` å…ƒä»¶çš„ `element` å±¬æ€§ä¾†æŒ‡å®šè¦æ¸²æŸ“çš„é é¢å…ƒä»¶ç­‰ JSX ç¨‹å¼ç¢¼ã€‚

### æŠŠ Route ç”¨ Routes åŒ…èµ·ä¾†

> éŒ¯èª¤è¨Šæ¯ï¼šA `<Route>` is only ever to be used as the child of `<Routes>` element, never rendered directly. Please wrap your `<Route>` in a `<Routes>`.

åœ¨ç¬¬ 5 ç‰ˆï¼Œæˆ‘å€‘ä¸ä¸€å®šè¦ä½¿ç”¨ `<Switch>` ä¾†åŒ…ä½ `<Route>`ï¼Œä½†æ˜¯åˆ°äº†ç¬¬ 6 ç‰ˆï¼ŒReact Router å°±å¼·åˆ¶å¤§å®¶éƒ½è¦åœ¨ `<Route>` å¤–é¢åŒ…ä¸€å±¤ `<Routes>`ã€‚

### ä¸å†éœ€è¦ exact å±¬æ€§

åœ¨ V5 æˆ‘å€‘éœ€è¦ä½¿ç”¨ `exact` ç¢ºä¿é…å°å®Œå…¨ç¬¦åˆçš„è·¯å¾‘ï¼Œæ‰ä¸æœƒèªªåªè¦å‰åŠæ®µç¬¦åˆå°±é€šé€šå‡ºç¾ã€‚  
ä½†æ˜¯åˆ°äº† V6ï¼Œæˆ‘å€‘ä¸éœ€è¦å†åŠ  `exact`ï¼Œå› ç‚ºå·²ç¶“é è¨­æ‰€æœ‰çš„ `<Route>` éƒ½æœƒå¥—ç”¨ `exact` çš„æ•ˆæœã€‚

é€™éº¼åšçš„å¥½è™•æ˜¯ï¼Œæˆ‘å€‘ä¸ç”¨é‚£éº¼åœ¨æ„è¨»å†Šè·¯ç”±æ™‚çš„ã€Œé †åºã€ã€‚

ä¹‹å‰åœ¨ V5ï¼Œå¦‚æœæœ‰ä½¿ç”¨åˆ°å‹•æ…‹è·¯ç”±ï¼Œæˆ‘å€‘éœ€è¦è¨˜å¾—æŠŠå‹•æ…‹è·¯ç”±æ”¾åˆ°è¼ƒå¾Œé¢çš„é †åºè¨»å†Šï¼Œå› ç‚ºå¦‚æœåº•ä¸‹é‚„æœ‰å…¶ä»–è·¯å¾‘ï¼ˆåƒæ˜¯ `/products/edit`ï¼‰ï¼ŒRouter æœƒæ°¸é ç„¡æ³•é€²å…¥é‚£ä¸€é ï¼Œå› ç‚ºå®ƒæœƒè¢«ä¸Šé¢çš„å‹•æ…‹è·¯å¾‘ `/products/:productId` æ””æˆªã€‚

å‡ç´šåˆ° V6 å¾Œï¼ŒReact Router æœƒå¹«æˆ‘å€‘è‡ªå‹•åŒ¹é…æœ€ä½³çš„è·¯ç”±ã€‚

çµåˆä»¥ä¸Šæ‰€è¿°ï¼Œæˆ‘å€‘ç¾åœ¨å¯ä»¥é€éä»¥ä¸‹å¯«æ³•ä¾†å®šç¾©è·¯ç”±ï¼š

```jsx
<Routes>
  <Route path="/welcome" element={<Welcome />} />
  <Route path="/products" element={<Products />} />
  <Route path="/products/:productId" element={<ProductDetail />} />
</Routes>
```

## èª¿æ•´ Nested Routes å®šç¾©æ–¹å¼

### åŠ ä¸Šç±³å­—è™Ÿä¾†é…å°å­å…ƒä»¶ä¸­çš„ Routes

å¦‚æœä½ æœ‰å·¢ç‹€è·¯ç”±ï¼Œä¾‹å¦‚ `/welcome` èˆ‡ `/welcome/new-user`ï¼Œä»–å€‘éƒ½æœƒé¡¯ç¤º `<Welcome>` é€™å€‹ Page Componentï¼Œå› ç‚ºæ˜¯å·¢ç‹€çš„é—œä¿‚ã€‚

åœ¨ React Router V6ï¼Œå¦‚æœå­å…ƒä»¶è£¡é¢æœ‰ `<Routes><Route /></Routes>`ï¼Œæˆ‘å€‘å°±å¿…é ˆä½¿ç”¨ `/welcome/*` è®“ Router å¯ä»¥è¨ªå•åˆ°å­è·¯ç”±ï¼Œè€Œä¸æ˜¯åªèƒ½èˆ‡ `/welcome` é€™ä¸€å€‹è·¯ç”±é…å°ã€‚

> [v6 docs](https://reactrouter.com/docs/en/v6/upgrading/v5#relative-routes-and-links): Routes with descendant routes (defined in other components) use a trailing `*` in their path to indicate they match deeply.

```jsx
<Route path="/welcome/*" element={<Welcome />} />
```

> åº•ä¸‹æåˆ°çš„é›†ä¸­ç®¡ç†çš„æ–¹å¼å‰‡ä¸éœ€è¦åŠ ä¸Šç±³å­—è™Ÿã€‚

### å­çµ„ä»¶çš„è·¯å¾‘å¯«æ³•

V6 å·¢ç‹€è·¯ç”±ä¸ç”¨å†æ’°å¯«ä¸Šå±¤çš„è·¯å¾‘ï¼Œå› ç‚º V6 æœƒå¹«æˆ‘å€‘è‡ªå‹•åˆ¤æ–·åŠ å…¥ï¼Œæ‰€ä»¥ `/welcome/*` åº•ä¸‹çš„å·¢ç‹€å­è·¯ç”±ï¼Œå°±å¯ä»¥å°‡ `/welcome/new-user` æ›¿æ›æˆ `new-user` å›‰ï¼

å¦‚æœä½¿ç”¨ `<Link>` ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œå¯ä»¥çœç•¥å‰é¢çš„è·¯ç”±ã€‚

ç„¶å¾Œç‰¹åˆ¥æ³¨æ„ï¼Œå¦‚æœè¦é€™æ¨£å¯«ï¼Œæœ€å‰æ–¹ã€Œä¸èƒ½åŠ ä¸Šæ–œç·šã€ï¼Œå¦å‰‡æœƒç›´æ¥æˆç‚ºç¬¬ä¸€å±¤è·¯ç”±ã€‚

```jsx
const Welcome = () => {
  return (
    <section>
      <h1>The Welcome Page</h1>
      <Link to="new-user">New User</Link>
      <Routes>
        <Route path="new-user" element={<p>Welcome, new user!</p>} />
      </Routes>
    </section>
  );
};
```

### V6 é›†ä¸­å®šç¾© Routesï¼Œæ­é… Outlet å…ƒä»¶ï¼Œä¸å†éœ€è¦ç±³å­—è™Ÿ

React Router V6 å…¨æ–°æ”¯æ´å°‡ Nested Routes é›†ä¸­æ–¼ App.js ä¸­å®šç¾©ï¼Œæ›´æ–¹ä¾¿æˆ‘å€‘ç®¡ç†å·¢ç‹€è·¯ç”±ï¼Œè€Œéåˆ†æ•£åœ¨å„å€‹çµ„ä»¶ç•¶ä¸­ã€‚

å¦å¤–ï¼Œä½¿ç”¨é€™å€‹å®šç¾©æ–¹å¼çš„è©±ï¼Œçˆ¶å±¤çš„ Route å¯ä»¥ä¸ç”¨åŠ ä¸Šç±³å­—è™Ÿï¼

> [v6 docs](https://reactrouter.com/docs/en/v6/upgrading/v5#advantages-of-route-element):  
> Notice how `<Route>` elements nest naturally inside a `<Routes>` element. Nested routes build their path by adding to the parent route's path. We didn't need a trailing `*` on `<Route path="users">` this time because when the routes are defined in one spot the router is able to see all your nested routes.
>
> You'll only need the trailing `*` when there is another `<Routes>` somewhere in that route's descendant tree. In that case, the descendant `<Routes>` will match on the portion of the pathname that remains (see the previous example for what this looks like in practice).

```jsx
<Route path="/welcome" element={<Welcome />}>
  <Route path="new-user" element={<p>Welcome, new user!</p>} />
</Route>
```

> é€™å€‹åšæ³•ä¸¦ä¸æ˜¯å¼·åˆ¶çš„ï¼Œåªæ˜¯æ›´æ¨è–¦é€™æ¨£è™•ç†å›‰ ğŸ‘

å®šç¾©å®Œæˆå¾Œï¼Œäº‹æƒ…é‚„æ²’çµæŸï¼Œæˆ‘å€‘é‚„éœ€è¦æŒ‡å®šå­è·¯ç”±è¦æ¸²æŸ“çš„ JSX è¦æ”¾åœ¨å“ªè£¡ã€‚  
é€™é‚Šæœƒä½¿ç”¨åˆ° V6 æ–°å¢çš„ `<Outlet>` å…ƒä»¶ï¼Œå®ƒåªæ˜¯ä¸€å€‹ Placeholderï¼Œç”¨ä¾†è¡¨ç¤ºè¦åœ¨å“ªè£¡æ’å…¥ JSX å…§å®¹ã€‚

```jsx
const Welcome = () => {
  return (
    <section>
      <h1>The Welcome Page</h1>
      <Link to="new-user">New User</Link>
      <Outlet />
    </section>
  );
};
```

## NavLink çš„ activeClassName å·²ç§»é™¤ï¼Œè«‹æ”¹ç”¨ ClassName

åœ¨ V5 æ™‚ï¼Œæˆ‘å€‘æƒ³è¦åŠ å€‹ `active` çš„ Class éƒ½é€™æ¨£åŠ ï¼Œä½†ç¾åœ¨é€™å€‹å±¬æ€§ç›´æ¥æ°äº†ã€‚

```jsx
<NavLink activeClassName={classes.active} to="/welcome">
  Welcome
</NavLink>
```

å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œåœ¨ `ClassName` ç”¨ä¸€å€‹ç‰¹æ®Šçš„æ–¹å¼ä¾†å¯¦ä½œï¼š

V6 çš„ `ClassName` ç¾åœ¨å¯ä»¥æ”¾ä¸€å€‹å‡½å¼ï¼  
é€™å€‹å‡½å¼æœ‰ä¸€å€‹åƒæ•¸ `navData`ï¼Œå®ƒæ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œè£¡é¢æœ‰ä¸€å€‹åç‚º `isActive` çš„å±¬æ€§ï¼Œé€™å€‹å±¬æ€§åœ¨è©² NavLink æ­£è¢«é€ è¨ªï¼Œè™•æ–¼æ´»å‹•ç‹€æ…‹ (Active) æ™‚ï¼Œå…¶å€¼å°±æœƒæ˜¯ trueã€‚

å¦‚ä½•ä½¿ç”¨å®ƒå‘¢ï¼Ÿæˆ‘å€‘é€éç®­é ­å‡½å¼æœƒ Return Value é€™ä¸€é»ï¼Œé€šéå‹•æ…‹åœ°åˆ¤æ–· `navData.isActive` çš„å€¼ï¼Œè‹¥ç‚º true å³å›å‚³ `classes.active`ï¼Œå¦å‰‡å›å‚³ç©ºå­—ä¸²ã€‚

```jsx
<NavLink
  className={(navData) => (navData.isActive ? classes.active : '')}
  to="/welcome"
>
  Welcome
</NavLink>
```

## Redirect æ”¹åå« Navigateï¼Œè€Œä¸”èƒ½ç”¨ replace

V5 ä½¿ç”¨ `<Redirect>` é€²è¡Œé‡æ–°å°å‘ã€‚

```jsx
<Switch>
  <Route path="/" exact>
    <Redirect to="/welcome" />
  </Route>
</Switch>
```

V6 å‰‡æ›´æ›æˆ `<Navigate>` å…ƒä»¶ã€‚

è‹¥åŠ ä¸Š `replace` å±¬æ€§ï¼Œå‰‡é‡æ–°å°å‘æ™‚æœƒä½¿ç”¨ã€Œå–ä»£ã€çš„æ–¹å¼ï¼Œå¦‚æœæ‹¿æ‰å°±æœƒæ˜¯é è¨­çš„ã€ŒPushã€çš„å°å‘æ–¹å¼ã€‚

```jsx
<Routes>
  <Route path="/" element={<Navigate replace to="/welcome" />} />
  <Route path="/welcome" element={<Welcome />} />
  <Route path="/products" element={<Products />} />
  <Route path="/products/:productId" element={<ProductDetail />} />
</Routes>
```

## ç§»é™¤ useHistory æ”¹ç”¨ useNavigate åŸ·è¡Œç¨‹å¼åŒ–å°èˆª

ç¬¬ 6 ç‰ˆæŠŠ useHistory ç§»é™¤äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ useNavigateï¼Œå®ƒä¸€æ¨£æ“æœ‰ Pushã€Replaceã€å‰å¾Œå°å‘ç­‰åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨å¯«æ³•ä¸Šçœ‹èµ·ä¾†æ›´ç°¡å–®å›‰ã€‚

```javascript
const navigate = useNavigate();
navigate('/welcome');

// å¦‚æœè¦ç”¨ Redirect ä¹Ÿå°±æ˜¯ Replace çš„è©±ï¼Œå¯ä»¥åŠ ä¸Šç¬¬äºŒå€‹åƒæ•¸
navigate('/welcome', { replace: true });

// å–®ç´”åŠ ä¸Š -1ï¼Œè¡¨ç¤ºå›åˆ°ä¸Šä¸€é 
navigate(-1);

// å›åˆ°ä¸Šä¸Šä¸€é 
navigate(-2);

// é€²åˆ°ä¸‹ä¸€é 
navigate(1);
```

é™¤æ­¤ä¹‹å¤–ï¼ŒuseNavigate åŒæ¨£ä¹Ÿèƒ½æ”¯æ´ç‰©ä»¶å½¢å¼ï¼Œå¯ä»¥è™•ç†æ¯”è¼ƒè¤‡é›œçš„è·¯å¾‘ã€‚

ç”šè‡³æ›´é€²ä¸€æ­¥ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ `createSearchParams` å¹«æˆ‘å€‘è‡ªå‹•å°‡ Params ç‰©ä»¶è½‰ç‚º URL å­—ä¸²ï¼  
å–”å°äº†ï¼Œsearch è¦è¨˜å¾—åœ¨æœ€å‰é¢åŠ ä¸Šä¸€å€‹ `?` å–”

```javascript
// æ”¯æ´ç‰©ä»¶å½¢å¼
navigate({
  pathname: `${location.pathname}`,
  search: `?sort=${isSortingAscending ? 'desc' : 'asc'}`,
});

// createSearchParams
const params = { sort: isSortingAscending ? 'desc' : 'asc' };
navigate({
  pathname: location.pathname,
  search: `?${createSearchParams(params)}`,
});
```

## Prompt ç›´æ¥ç§»é™¤ï¼Œæ²’æœ‰æ›¿ä»£æ–¹æ¡ˆ

é€™å€‹æ˜¯ç¼ºé»ï¼Œç›®å‰é‚„æ²’æœ‰æ›¿ä»£æ–¹æ¡ˆï¼Œåªèƒ½è‡ªå·±æå®š â‹¯â‹¯React Router åœ˜éšŠçµ¦é»æ–¹æ³•å§ï¼ŒçœŸçš„æ˜¯å“­å•Šï¼

## Optimize code with Lazy Loading and Suspense fallback

- React.memo
- Lazy Loading - Load code only when it's needed.

é€²å…¥é é¢å‰ï¼ŒBrowser æœƒè¼‰å…¥æˆ‘å€‘æ‰“åŒ…çš„æ•´å€‹ Bundleï¼Œæ¶µè“‹æ‰€æœ‰çš„ React Codeï¼Œè®“æˆ‘å€‘é€²å…¥å¾Œå¯ä»¥çœ‹åˆ°æ¸²æŸ“çš„é é¢ï¼Œä»¥åŠ Reactive çš„å„ç¨®ç‹€æ…‹ã€‚

é€™ä¹Ÿä»£è¡¨è‘—é€²å…¥é é¢çš„ Users å¿…é ˆç­‰å¾…ä¸‹è¼‰ Code çš„éç¨‹ï¼Œç›´åˆ°æˆ‘å€‘çš„ Web App æº–å‚™å®Œç•¢ç‚ºæ­¢ã€‚

å› æ­¤ï¼Œæˆ‘å€‘æƒ³è¦åšçš„æ˜¯å„˜é‡æ¸›å°‘ Users åˆæ¬¡è¼‰å…¥é é¢çš„ç­‰å¾…æ™‚é–“ï¼Œé€éæŠŠå¤§åŒ…çš„ Bundle åˆ‡åˆ†æˆä¸€å°åŒ…ä¸€å°åŒ… (chunk) çš„æ–¹å¼ï¼Œä¸¦ä¸”åªæœ‰åœ¨è¨ªå•åˆ°è©²é é¢æ™‚ï¼Œæ‰å»ä¸‹è¼‰è©²é é¢çš„ Codeã€‚

ä¾‹å¦‚ï¼šåˆå§‹é€²å…¥çš„é é¢æ˜¯ All Quotes é é¢ (`ourdomain.com/quotes`)ï¼Œæ­¤æ™‚å°±ä¸éœ€è¦è¼‰å…¥ New Quote é é¢ (`ourdomain.com/new-quote`) çš„ç¨‹å¼ç¢¼ã€‚

```jsx
// import NewQuote from './pages/NewQuote';
const NewQuote = React.lazy(() => import('./pages/NewQuote'));
```

æ­¤æ™‚å›åˆ°é é¢ï¼Œæœƒç™¼ç¾é é¢é¡¯ç¤ºæœ‰éŒ¯èª¤ã€‚é€™æ˜¯å› ç‚ºæˆ‘å€‘æŠŠæª”æ¡ˆæ‹†åˆ†æˆ chunks ä¹‹å¾Œï¼Œå¦‚æˆ‘å€‘æ‰€é¡˜ï¼ŒReact Router é€²è¡Œäº†å»¶é²åŠ è¼‰ï¼Œä½†æ˜¯ React å»ä¹Ÿå› æ­¤ç„¡æ³•é †åˆ©é€²è¡Œæ¸²æŸ“çš„å·¥ä½œï¼Œå› æ­¤è€Œå°è‡´ React å ±éŒ¯ã€‚

ç‚ºäº†è®“ React ç¹¼çºŒé€²è¡Œæ¸²æŸ“è€Œéå ±éŒ¯ï¼Œæˆ‘å€‘å¯ä»¥æº–å‚™ä¸€å€‹æ›¿ä»£çš„å…ƒä»¶ `<Suspense>` çµ¦å®ƒï¼Œè®“ React åœ¨è¼‰å…¥å®Œæˆå‰å…ˆæ¸²æŸ“é€™å€‹æ›¿ä»£å…§å®¹ã€‚
å…¶ä¸­çš„æ›¿ä»£å…§å®¹æˆ‘å€‘å°±å¯«åœ¨ `fallback` é€™å€‹å±¬æ€§è£¡é¢ï¼Œåˆ©ç”¨ç®­é ­å‡½å¼å›å‚³ JSX å…§å®¹ã€‚

ç¯„ä¾‹ï¼šå°‡ Lazy Loading æ‡‰ç”¨åœ¨å„å€‹éœ€è¦çš„é é¢ä¸Š

```jsx
const AllQuotes = React.lazy(() => import('./pages/AllQuotes'));
const NewQuote = React.lazy(() => import('./pages/NewQuote'));
const QuoteDetail = React.lazy(() => import('./pages/QuoteDetail'));
const NotFound = React.lazy(() => import('./pages/NotFound'));

function App() {
  return (
    <div>
      <Layout>
        <Suspense
          fallback={
            <div className="centered">
              <LoadingSpinner />
            </div>
          }
        >
          <Routes>
            <Route path="/quotes" element={<AllQuotes />} />
            <Route path="/new-quote" element={<NewQuote />} />
            <Route path="/quotes/:quoteId/*" element={<QuoteDetail />} />
            <Route path="*" element={<NotFound />} />
          </Routes>
        </Suspense>
      </Layout>
    </div>
  );
}
```

## Recap

çœ‹å®Œé€™ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘åˆ°åº•æœ‰ä»€éº¼æ”¶ç©«å‘¢ï¼Ÿè—‰ç”±æœ¬æ–‡å¯ä»¥ç†è§£åˆ°â€¦

- Upgrading To React Router v6

## References

- [React - The Complete Guide (incl Hooks, React Router, Redux)](https://www.udemy.com/course/react-the-complete-guide-incl-redux/)
