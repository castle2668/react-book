---
sidebar_position: 2
---

# Working with State

## ⚓ useState Hook

> 💡 單向綁定
> 💡 除非 DOM 移除，否則 useState 管理的 state 都不會重新初始化，只會在第一次載入時初始化。

進行 setState 時並不會馬上更改狀態，而是會進入排程，優先完成更重要的工作，不過 React 還是會確保我們改變 State 的順序是正確的。
但是會發生以下問題，如果排程了多個 setState，則會到最後才按照排程順序執行狀態改變，結果就會是 Book。

```jsx
const [state, setState] = useState('DVD');

setState('Pencil');
setState('Book'); // 最後的狀態會變成 Book
```

但有時候我們需要馬上取得改變的結果去做一些應用或計算，我們就可以用函式的形式，讓狀態更新可以依賴於之前的狀態快照 (snapshot)。
這樣我們就能得到基於狀態快照的新狀態，而不是永遠都只會拿到最新的那一個狀態哩！

👇 Updating State That Depends On The Previous State.
Safer way: Ensure the Latest state snapshot (If it depends on the previous state)

```jsx=
setUserInput((prevState) => {
  return { ...prevState, enteredTitle: event.target.value };
});
```

我們也可以使用 useEffect，它跟函式形式一樣都會去看依賴的狀態有沒有改變，如果改變了就會馬上執行 setState，不會錯過狀態改變，能夠確保取得最新的狀態。
因此，在 useEffect 裡使用的 setState 即使不是函式的形式，也會即時更新狀態。

## Lifting The State Up (Emit, from child to parent)

> 💡 Parent component needs data generated in Child component.

Step 1: 在 Parent 建立一個函式，用來作為一個要傳給 Child 的 Props `onXxx` 的 Value (type: Function)。

```jsx
// Inside of the "ParentComponent" component function

const xxxHandler = () => {
  // do something...
};

// Return JSX
<ChildComponent onXXX={xxxHandler} />;
```

Step 2: 在 Child 執行函式 `props.onXxx`，此時等同於執行了 Parent 的 `xxxHandler` 函式，因為它們傳遞的是 **Pointer (By Reference)**。

```jsx
// Inside of the "ChildComponent" component function

props.onXxx();
```

Step 3: 從 Child 放入參數傳回 Parent，Parent 從參數獲得 Child 的 Data，此即完成 Emit 的動作。

```jsx
// Inside of the "ChildComponent" component function

const childData = {
  title: 'Child Title',
  data: new Date(),
};

props.onXxx(childData);
```

```jsx
// Inside of the "ChildComponent" component function

const xxxHandler = (enteredChildData) => {
  // do something...
  const childData = { ...enteredChildData };
  console.log(childData);
};

// Return JSX
<ChildComponent onXXX={xxxHandler} />;
```

## 回顧

看完這篇文章，我們到底有什麼收穫呢？藉由本文可以理解到…

- React

## References

- [React - The Complete Guide (incl Hooks, React Router, Redux)](https://www.udemy.com/course/react-the-complete-guide-incl-redux/)
