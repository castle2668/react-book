---
sidebar_position: 1
---

# è§£æ toString() æ–¹æ³• ft. typeof, instanceof

æœ¬æ–‡ä¸»è¦å…§å®¹ç‚ºæ¢è¨ JavaScript ä¸­ toString() æ–¹æ³•çš„ç›¸é—œçŸ¥è­˜ï¼Œä»¥åŠé—œéµå­— typeof å’Œ instanceof çš„ä½¿ç”¨ã€‚

## ä½¿ç”¨ç‰©ä»¶çš„ toString() æª¢æ¸¬å„ç¨®å‹åˆ¥

JavaScript ä¸­æœ‰å€‹é—œéµå­— `typeof`ï¼Œé¡§åæ€ç¾©ï¼Œå®ƒèƒ½å¤ å›å‚³å‹åˆ¥ã€‚

ç„¶è€Œå¦‚æœè¦ç²¾æº–åœ°åˆ¤æ–·å‹åˆ¥ï¼Œæˆ‘å€‘æ‡‰è©²ä½¿ç”¨ç‰©ä»¶çš„ `toString()` è€Œä¸æ˜¯ `typeof`ï¼Œç‚ºä»€éº¼å‘¢ï¼Ÿ

### ä½¿ç”¨ typeof åˆ¤æ–·å‹åˆ¥

```javascript
var a = 3;
console.log(typeof a); // number

var b = 'Hello';
console.log(typeof b); // string

var c = { firstname: 'Sealman' };
console.log(typeof c); // object

var d = [];
console.log(typeof d); // object

const z = function () {};
console.log(typeof z); // function
```

æˆ‘å€‘å¯ä»¥çœ‹åˆ°é—œéµçš„å•é¡Œå‡ºåœ¨ Object èˆ‡ Array èº«ä¸Šï¼Œé—œéµå­— `typeof` æ²’è¾¦æ³•åˆ¤æ–·å‡ºé™£åˆ—ï¼Œå› ç‚ºåœ¨ JavaScript ä¸­ï¼Œé™¤äº†åŸºæœ¬å‹åˆ¥ä»¥å¤–çš„å…¶ä»–æ±è¥¿éƒ½æ˜¯ç‰©ä»¶ï¼

### ä½¿ç”¨ toString() åˆ¤æ–·å‹åˆ¥

æ‰€æœ‰çš„ç´”å€¼ï¼ˆåŸºæœ¬å‹åˆ¥ï¼‰é™¤äº† null è·Ÿ undefined ä¹‹å¤–éƒ½æœ‰ `toString()` æ–¹æ³•ã€‚

é€™äº› `toString()` æ–¹æ³•æ˜¯å¾ `Object.prototype` ä¸­ç¹¼æ‰¿ä¸‹ä¾†çš„ï¼Œä½†æ˜¯å¾ˆå¤šæ±è¥¿ä¸æœƒæ˜¯ä¸€æˆä¸è®Šçš„ï¼Œç¹¼æ‰¿å¾Œ JavaScript é‡å¯«äº†é€™å€‹æ–¹æ³•è®“å®ƒæ›´åŠ å¯¦ç”¨ã€‚

èˆ‰ä¾‹ä¾†èªªï¼Œå…’å­ Array ç¹¼æ‰¿è‡ªçˆ¸çˆ¸ Objectï¼Œç¹¼æ‰¿æ™‚ JavaScript åœ¨ `Array.prototype` ä¸Šé‡å¯«äº† `toString()` æ–¹æ³•ï¼Œæ‰€ä»¥ä½¿ç”¨ `arr.toString()` æ™‚ï¼Œå¯¦éš›èª¿ç”¨çš„æ˜¯ `Array.prototype.toString()`ã€‚

```javascript
// æ•¸å­—çš„é™£åˆ— [0, 1, 2] å¯ä»¥ç›´æ¥è½‰æˆå­—ä¸² "0,1,2"
var arr = [0, 1, 2]; // "0,1,2"
console.log(arr.toString());
```

å†çœ‹çœ‹å¦ä¸€å€‹å…’å­ã€Œæ•¸å€¼ã€æ‰€æ”¹å¯«çš„ `toString()` æ–¹æ³•ï¼Œå®ƒç”šè‡³å¯ä»¥æŠŠæ•¸å€¼è½‰æ›æˆä¸åŒçš„é€²ä½åˆ¶ã€‚

```javascript
var num = 10;
console.log(num.toString(2)); // 10 é€²ä½è½‰ç‚º 2 é€²ä½ => 1010
```

è‡³æ–¼ç‰©ä»¶ç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ `toString()`ï¼Œä½†æ˜¯çµæœæœƒé¡¯ç¤ºæˆ `"[object Object]"` é€™ç¨®æ¨£å­ã€‚

æƒ³è¦çœ‹åˆ° `key: value` é‚„æ˜¯å¾—ç”¨ Loopï¼Œæˆ–æ˜¯ä½¿ç”¨ `JSON.stringify()` ä¹Ÿå¯ä»¥çœ‹åˆ°å®Œæ•´ Object çš„ä¸€è¡Œå­—ä¸²ã€‚

```javascript
var a = 3;
console.log(a.toString()); // "3"

var b = 'Hello';
console.log(b.toString()); // "Hello"

var c = { firstname: 'Sealman' };
console.log(c.toString()); // "[object Object]"
console.log(JSON.stringify(c)); // {"firstname":"Sealman"}
```

å¦‚æœæ˜¯é™£åˆ—å‘¢ï¼Ÿé™£åˆ—ä¹Ÿæ˜¯ä¸€ç¨®ç‰©ä»¶ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šè·Ÿç‰©ä»¶çš„çµæœä¸€æ¨£ã€‚

å·®åˆ¥åœ¨æ–¼é™£åˆ—çš„ `toString()` æ–¹æ³•æœƒè©¦è‘—å°‡é™£åˆ—ä¸­çš„**ç‰©ä»¶**è½‰ç‚ºå­—ä¸²ï¼Œæ­¤æ™‚å¦‚æœæ˜¯ã€Œç©ºé™£åˆ—ã€å°±æœƒç­‰æ–¼é™£åˆ—ä¸­æ²’æœ‰ç‰©ä»¶ï¼Œçµæœå°±æœƒå›å‚³ç©ºå­—ä¸²ã€‚

```javascript
var d = [];
console.log(typeof d); // object
console.log(d.toString()); // "" (ç©ºå­—ä¸²)

var d = [{}];
console.log(d.toString()); // [object Object]
console.log(JSON.stringify(d)); // "[{}]"
```

ç„¶è€Œï¼Œåˆ°ç›®å‰ç‚ºæ­¢ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾é™£åˆ—å’Œç‰©ä»¶ä½¿ç”¨ `toString()` çš„çµæœéƒ½æ˜¯ `"[object Object]"`ï¼Œæ‰€ä»¥å•é¡Œé‚„æ²’æœ‰è§£æ±ºï¼Œåˆ°åº•è¦æ€éº¼æª¢é©—å€åˆ†å‡º Array è·Ÿ Object å‘¢ï¼Ÿ

### ä½¿ç”¨ Object.prototype.toString.call() åˆ¤æ–·å‹åˆ¥

ç­”æ¡ˆå°±æ˜¯ä½¿ç”¨ç‰©ä»¶çš„åŸå‹çš„ `toString()` æ–¹æ³•ï¼Œæ­é…ä½¿ç”¨ `.call()` ä¾†æ§åˆ¶ `this` æŒ‡å‘ä¸¦ä¸”å‘¼å«ï¼Œå°±èƒ½ç²¾æº–åœ°åˆ¤æ–·å„ç¨®å‹åˆ¥å›‰ï¼

ä¾‹å¦‚ï¼šé™£åˆ—æœƒå¾—åˆ° `[object Array]`ï¼Œç‰©ä»¶å‰‡æœƒå¾—åˆ° `[object Object]`ï¼Œé€™æ¨£å­å°±èƒ½åˆ†è¾¨ç‰©ä»¶èˆ‡é™£åˆ—å“©ã€‚

#### toString() èˆ‡ Object.prototype.toString() æœ‰ä½•ä¸åŒ

Qï¼šä»€éº¼æ˜¯ `Object.prototype.toString()`ï¼Ÿ

Aï¼šå…§å»ºçš„å‡½å¼å»ºæ§‹å­åŠ ä¸Š `.prototype` å°±æ˜¯æŒ‡å®ƒå€‘çš„åŸå‹ï¼Œåœ¨åŸå‹ä¸Šæœ‰å…§å»ºæ–¹æ³•ï¼Œåƒæ˜¯ç‰©ä»¶çš„åŸå‹ä¸Šæœ‰ `toString()` æ–¹æ³•ã€‚

- Objectã€Arrayã€Dateã€Function â†’ å…§å»ºçš„å‡½å¼å»ºæ§‹å­
- `Object.prototype` â†’ é è¨­çš„åŸç”ŸåŸå‹

  ```javascript
  console.log(Object.prototype); // åŸºæœ¬ç‰©ä»¶
  console.log(Object.prototype.__proto__); // null
  ```

- `Object.prototype.toString()` â†’ å…§å»ºæ–¹æ³•

å› ç‚ºç‰©ä»¶çš„ `toString()` æ–¹æ³•æœƒè¿”å› **[object "type"]**ï¼Œå…¶ä¸­ type æ˜¯æŒ‡é€™å€‹ç‰©ä»¶çš„é¡åˆ¥ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ç™¼ç¾é€™å€‹ type å°±èƒ½æ‹¿ä¾†å€åˆ¥ç‰©ä»¶èˆ‡é™£åˆ—ã€‚

æˆ‘å€‘è®“æ¯å€‹æ±è¥¿éƒ½é€šé `Object.prototype.toString()` æª¢æ¸¬ï¼Œé€™å€‹æ–¹æ³•èƒ½åˆ¤æ–·æ‰€æœ‰çš„å‹åˆ¥å–”ï¼

```javascript
console.log(Object.prototype.toString.call(a)); // [object Number]
console.log(Object.prototype.toString.call(b)); // [object String]
console.log(Object.prototype.toString.call(c)); // [object Object]
console.log(Object.prototype.toString.call(d)); // [object Array]
console.log(Object.prototype.toString.call(undefined)); // [object Undefined]
console.log(Object.prototype.toString.call(null)); // [object Null]
```

çµè«–ï¼šå¦‚æœè¦ç²¾ç¢ºåœ°åˆ¤æ–·å‹åˆ¥ï¼Œç‰¹åˆ¥æ˜¯å€åˆ†ç‰©ä»¶èˆ‡é™£åˆ—ï¼Œå°±è¦ç”¨ç‰©ä»¶çš„ `toString()` æ–¹æ³•ã€‚

## å¦ä¸€å€‹é—œéµå­— instanceof

å¦‚æœç‰©ä»¶ `e` èƒ½åœ¨åŸå‹éˆä¸Šæ‰¾åˆ°ç‰©ä»¶ `Person` å°±æœƒå›å‚³ trueï¼Œä¹Ÿå°±ä»£è¡¨ `e` æ˜¯ `Person` çš„ Instanceã€‚

```javascript
function Person(name) {
  this.name = name;
}
var e = new Person('Sealman');
console.log(e); // PersonÂ {name: "Sealman"}
console.log(typeof e); // object
console.log(e instanceof Person); // true
```

## è¬å¹´ bug - typeof null

å‰›æ‰è¬› `typeof` çš„æ™‚å€™æ²’æœ‰æåˆ° undefined èˆ‡ nullã€‚

é¦–å…ˆ `typeof undefined` å¾—åˆ° undefined çš„çµæœé‚„ç®—åˆç†ï¼Œå› ç‚º undefined ä»£è¡¨æ²’æœ‰æ±è¥¿ï¼Œæ‰€ä»¥å‹åˆ¥å°šæœªå®šç¾©æ˜¯å¯ä»¥æ¥å—çš„çµæœã€‚

ä¸é `typeof null` å¾—åˆ°ç‰©ä»¶ (object) é€™å€‹çµæœå°±æ˜¯ JavaScript çš„ bug äº†ï¼Œä½†æ˜¯å› ç‚ºé€™å€‹å•é¡Œå­˜åœ¨å¾ˆä¹…äº†ï¼Œéå»å»ºç½®çš„ç¶²ç«™å¯èƒ½æœ‰ç”¨åˆ°ï¼Œæ‰€ä»¥ä¸èƒ½ä¿®æ­£å“© ğŸ¤”

```javascript
console.log(typeof undefined); // undefined
console.log(typeof null); // object
```

## å›é¡§

çœ‹å®Œé€™ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘åˆ°åº•æœ‰ä»€éº¼æ”¶ç©«å‘¢ï¼Ÿè—‰ç”±æœ¬æ–‡å¯ä»¥ç†è§£åˆ°â€¦

- å¦‚ä½•ä½¿ç”¨ `typeof`
- ä¸‰ç¨®åˆ¤æ–·å‹åˆ¥çš„æ–¹æ³•ï¼Œä»¥åŠå“ªä¸€å€‹èƒ½å¤ æœ€ç²¾ç¢ºåœ°åˆ¤æ–·å‹åˆ¥
- JavaScript ä¸­ `toString()` èˆ‡ `Object.prototype.toString()` æœ‰ä½•ä¸åŒ
- å¦‚ä½•ä½¿ç”¨ `instanceof`
- JavaScript è¬å¹´ bug - `typeof null`

## References

- [JavaScript: Understanding the Weird Parts](https://www.udemy.com/course/understand-javascript/)
