---
sidebar_position: 2
---

# Introducing React Context

## React Context (Context API)

ç•¶ Props å¾ Parent å‚³åˆ° Childï¼Œå†å¾€ä¸‹å‚³çµ¦ä¸‹ä¸€å€‹ Child æ™‚ï¼Œé€™æ¨£ä¸€å±¤ä¸€å±¤çš„å‚³ééˆåœ¨å¤§å‹å°ˆæ¡ˆä¸Šæœƒç›¸ç•¶è¤‡é›œï¼Œæ­¤æ™‚å°±å¯ä»¥ä½¿ç”¨ Context API ä¾†è™•ç†ã€‚

ä¾‹å¦‚ï¼šæ˜¯å¦ç™»å…¥çš„ç‹€æ…‹éœ€è¦ä½¿ç”¨åœ¨è¨±å¤šå ´æ™¯ï¼Œç”¨ä¾†é©—è­‰ç”¨æˆ¶æ˜¯å¦ç™»å…¥ï¼›äº¦æˆ–æ˜¯è³¼ç‰©è»Šè³‡æ–™éœ€è¦é¡¯ç¤ºæ–¼ä¸åŒé é¢ã€‚

å¦‚æœæˆ‘å€‘å¯ä»¥çœç•¥ä¸­é–“çš„é€™äº›è½‰ç™¼çš„éç¨‹ï¼Œç›´æ¥å¾çˆ¶çµ„ä»¶å‚³é Props çµ¦çœŸæ­£éœ€è¦è³‡æ–™çš„å­çµ„ä»¶çš„è©±ï¼Œä¸å•»æ˜¯ä¸€å€‹æ–¹ä¾¿ä¸”å„ªé›…çš„æ–¹å¼å—ï¼Ÿ

å› æ­¤ï¼Œæˆ‘å€‘æœ‰äº† React Contextã€‚

### å‰ç½® 1ï¼šReact.createContext

åœ¨ src ä¸‹å»ºç«‹ store è³‡æ–™å¤¾ï¼Œä¸¦æ–°å¢ä¸€å€‹ Contextï¼Œå®ƒæœƒç”¨ä¾†ç®¡ç†èˆ‡ç™»å…¥æˆæ¬Šç›¸é—œçš„ç‹€æ…‹ã€‚

é€™å€‹ AuthContext æœ¬èº«ä¸¦ä¸æ˜¯ä¸€å€‹çµ„ä»¶ï¼Œå®ƒæ˜¯ç”¨ä¾†åŒ…è‘—çµ„ä»¶çš„ä¸€å€‹ç‰©ä»¶ã€‚

```jsx
import React from 'react';

const AuthContext = React.createContext({
  isLoggedIn: false,
});

export default AuthContext;
```

å¦‚æœåœ¨æŸå€‹å­å…ƒä»¶æœƒç”¨åˆ° Contextï¼Œé‚£å°±æ˜¯ç”¨ AuthContext åŒ…ä½é‚£ä¸€å€‹å­å…ƒä»¶ã€‚

å¦‚æœæ•´å€‹ App åˆ°è™•éƒ½æœƒç”¨åˆ°ï¼Œé‚£ä¹Ÿå¯ä»¥é¸æ“‡ç”¨ AuthContext åŒ…ä½æ•´å€‹ App çš„å…§å®¹ï¼Œå¦‚åŒæ¥ä¸‹ä¾†çš„ç¯„ä¾‹ã€‚

### å‰ç½® 2ï¼šContext.Provider

åœ¨åŒ…çš„æ™‚å€™ï¼Œæˆ‘å€‘æœƒåŠ ä¸Š `.Provider` å°‡é€™å€‹ React Context ç‰©ä»¶è®Šæˆä¸€å€‹çµ„ä»¶ï¼Œé€™æ¨£å°±èƒ½æä¾› Store çš„è³‡æ–™çµ¦å…§å±¤çš„å­å…ƒä»¶ä½¿ç”¨äº†ã€‚

```jsx
return (
  <AuthContext.Provider>
    <MainHeader isAuthenticated={isLoggedIn} onLogout={logoutHandler} />
    <main>
      {!isLoggedIn && <Login onLogin={loginHandler} />}
      {isLoggedIn && <Home onLogout={logoutHandler} />}
    </main>
  </AuthContext.Provider>
);
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæ­¤æ™‚ MainHeaderã€Loginã€Home ç­‰å…ƒä»¶éƒ½å¯ä»¥è¨ªå•åˆ° AuthContext å›‰ï¼

### ç”¨æ³• 1ï¼šä½¿ç”¨ Context.Consumer

React.Context.Consumer çµ„ä»¶æœ¬èº«è‡ªå¸¶ä¸€å€‹ `{child}`ï¼Œä¸¦ä¸”æ˜¯ä¸€å€‹å‡½å¼ `(ctx) â‡’ {}` çš„å½¢å¼ã€‚

åƒæ•¸ `ctx` å°±æ˜¯æŒ‡å‘å‰›æ‰ Store è£¡é¢çš„è³‡æ–™ï¼Œåƒæ˜¯ `{ isLoggedIn: false }`ï¼Œè€Œå‡½å¼çš„æœ€å¾Œæœƒ return è¦å­˜å–é€™å€‹è³‡æ–™çš„ JSX ç¨‹å¼ç¢¼ã€‚

```jsx
import React from 'react';

import AuthContext from '../../store/auth-context';
import classes from './Navigation.module.css';

const Navigation = (props) => {
  return (
    <AuthContext.Consumer>
      {(ctx) => {
        return (
          <nav className={classes.nav}>
            <ul>
              {ctx.isLoggedIn && (
                <li>
                  <a href="/">Users</a>
                </li>
              )}
              {props.isLoggedIn && (
                <li>
                  <a href="/">Admin</a>
                </li>
              )}
              {props.isLoggedIn && (
                <li>
                  <button onClick={props.onLogout}>Logout</button>
                </li>
              )}
            </ul>
          </nav>
        );
      }}
    </AuthContext.Consumer>
  );
};

export default Navigation;
```

> æ­¤æ™‚ï¼Œå¦‚æœç¶²é  Crash äº†ï¼Œé‚£éº¼æœ‰å¯èƒ½æ˜¯ä½ åŒæ™‚ä½¿ç”¨äº† Provider èˆ‡ Consumerï¼Œä»¥ä¸‹æä¾›è§£æ±ºæ–¹å¼

#### è§£æ³•ä¸€ï¼šåªä½¿ç”¨ Consumer å­˜å–é»˜èªå€¼å°±å¥½

å¦‚æœåªæƒ³ä½¿ç”¨ Consumer ä¾†å­˜å–**é»˜èªå€¼**ï¼Œä¹Ÿå°±æ˜¯ `{ isLoggedIn: false }`ï¼Œé‚£éº¼ä½¿ç”¨ Consumer æ™‚å°±ä¸è¦åŒæ™‚ç”¨ Providerã€‚

æŠŠå‰›æ‰åŒ…è¦†çš„ Provider å…ˆæ‹¿æ‰ï¼Œé€™æ¨£ Consumer å°±èƒ½æ­£å¸¸æä¾›é»˜èªå€¼ã€‚

```jsx
return (
  <React.Fragment>
    <MainHeader isAuthenticated={isLoggedIn} onLogout={logoutHandler} />
    <main>
      {!isLoggedIn && <Login onLogin={loginHandler} />}
      {isLoggedIn && <Home onLogout={logoutHandler} />}
    </main>
  </React.Fragment>
);
```

#### è§£æ³•äºŒï¼šåŒæ™‚ä½¿ç”¨ Consumer èˆ‡ Provider æ™‚ï¼ŒProvider è¦æ­é… value

å¦ä¸€å€‹æ–¹æ³•æ˜¯æˆ‘å€‘åŒæ™‚ä½¿ç”¨å…©è€…ï¼Œä½†æ˜¯ Provider è¦åŠ ä¸Š `value`ã€‚

```jsx
return (
  <AuthContext.Provider
    value={{
      isLoggedIn: false,
    }}
  >
    <MainHeader isAuthenticated={isLoggedIn} onLogout={logoutHandler} />
    <main>
      {!isLoggedIn && <Login onLogin={loginHandler} />}
      {isLoggedIn && <Home onLogout={logoutHandler} />}
    </main>
  </AuthContext.Provider>
);
```

é™¤æ­¤ä¹‹å¤–ï¼ŒProvider çš„å€¼é‚„å¯ä»¥åšæ›´æ”¹ï¼Œç”¨ä¾†è¨­å®šè¼‰å…¥æ™‚çš„åˆå§‹å€¼ã€‚

Example: Listen state (`isLoggedIn`) changes, and pass down to all components we consume this Context

```jsx
return (
  <AuthContext.Provider
    value={{
      // -------- listen useState changes
      isLoggedIn: isLoggedIn,
    }}
  >
    <MainHeader onLogout={logoutHandler} />
    <main>
      {!isLoggedIn && <Login onLogin={loginHandler} />}
      {isLoggedIn && <Home onLogout={logoutHandler} />}
    </main>
  </AuthContext.Provider>
);
```

### ğŸ‘ ç”¨æ³• 2: âš“ useContext Hook

é™¤äº†é€é Context.Consumer ä¾†å­˜å– Store ä¹‹å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨ useContext ä¾†å–ç”¨ AuthContextã€‚

> [useContext - React å®˜æ–¹æ–‡ä»¶](https://zh-hant.reactjs.org/docs/hooks-reference.html#usecontext)

```jsx
const value = useContext(MyContext);
```

`useContext` æœƒæ¥æ”¶ä¸€å€‹ context objectï¼ˆ`React.createContext` çš„å›å‚³å€¼ï¼‰ä¸¦å›å‚³è©² context ç›®å‰çš„å€¼ã€‚Context ç›®å‰çš„å€¼æ˜¯å–æ±ºæ–¼ç”±ä¸Šå±¤ component è·é›¢æœ€è¿‘çš„ `<MyContext.Provider>` çš„ `value` propã€‚

> è¦å‚³ String, Object, Function éƒ½å¯ä»¥ï¼

```jsx
// Provider

return (
  <AuthContext.Provider
    value={{
      isLoggedIn: isLoggedIn,
      // Pass logoutHandler down to all components we consume this Context
      onLogout: logoutHandler,
    }}
  >
    <MainHeader />
    <main>
      {!isLoggedIn && <Login onLogin={loginHandler} />}
      {isLoggedIn && <Home onLogout={logoutHandler} />}
    </main>
  </AuthContext.Provider>
);
```

ä¸‹é¢å°±æ˜¯ `useContext` çš„å¯«æ³•ï¼Œå¯ä»¥ç™¼ç¾å¯«æ³•çœŸçš„ç°¡æ½”å„ªé›…å¾ˆå¤šï¼Œå¤§æ¨ ğŸ‘

```jsx
// useContext

import React, { useContext } from 'react';

import AuthContext from '../../store/auth-context';
import classes from './Navigation.module.css';

const Navigation = (props) => {
  const ctx = useContext(AuthContext);

  return (
    <nav className={classes.nav}>
      <ul>
        {ctx.isLoggedIn && (
          <li>
            <a href="/">Users</a>
          </li>
        )}
        {ctx.isLoggedIn && (
          <li>
            <a href="/">Admin</a>
          </li>
        )}
        {ctx.isLoggedIn && (
          <li>
            <button onClick={props.onLogout}>Logout</button>
          </li>
        )}
      </ul>
    </nav>
  );
};

export default Navigation;
```

```jsx
// Use Navigation Component

const Navigation = () => {
  const ctx = useContext(AuthContext);

  return (
    <nav className={classes.nav}>
      <ul>
        {/* omit above code */}
        {ctx.isLoggedIn && (
          <li>
            <button onClick={ctx.onLogout}>Logout</button>
          </li>
        )}
      </ul>
    </nav>
  );
};
```

### Props vs. Context

é€™æ¨£çœ‹èµ·ä¾†ï¼Œæœ‰äº›æ™‚å€™ä½¿ç”¨ Props é‚„æ˜¯ Context å¥½åƒéƒ½èƒ½é”åˆ°å‚³éçš„æ•ˆæœï¼Œé‚£å®ƒå€‘å…©å€‹çš„ä½¿ç”¨æ™‚æ©Ÿè©²æ€éº¼æ±ºå®šå‘¢ï¼Ÿ

å…¶å¯¦åœ¨ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘éƒ½ä½¿ç”¨ Props å±…å¤šï¼Œé€™æ¨£æ‰èƒ½è®“çµ„ä»¶å…·æœ‰ã€Œè¤‡ç”¨æ€§ã€ã€‚

å› ç‚ºå¦‚æœä½¿ç”¨ Contextï¼Œé‚£éº¼è©²çµ„ä»¶å°±æœƒæ°¸é æ˜¯é‚£ä¸€å€‹åŠŸèƒ½ï¼Œä¾¿æœƒå¤±å»å®ƒçš„è¤‡ç”¨æ€§ã€‚æ‰€ä»¥é€šå¸¸åªæœ‰ç•¶æˆ‘å€‘è¦è½‰ç™¼çš„è³‡æ–™ï¼Œéœ€è¦è¶Šéå¾ˆå¤šå…ƒä»¶æ™‚ï¼Œæˆ–æ˜¯è©²å…ƒä»¶æœ‰ä¸€å€‹æ˜ç¢ºã€å…·é«”çš„ä½œç”¨æ™‚ï¼Œæˆ‘å€‘æ‰æœƒä½¿ç”¨åˆ° Contextã€‚

### Better IDE support and autocomplete

ä½¿ç”¨ Context æ™‚ï¼Œå»ºè­°åªè¦æœ‰èª¿ç”¨åˆ°ï¼Œå°±æ‡‰è©²è¦åŠ é€² Context çš„ã€Œé»˜èªå€¼ã€ï¼Œä¾‹å¦‚ï¼šå‡½å¼å¯ä»¥å®šç¾©ä¸€å€‹ Dummy Functionï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œåƒæ˜¯æˆ‘å€‘åœ¨è¼¸å…¥ `ctx.` æ™‚ï¼Œå°±æœƒå‡ºç¾è¼¸å…¥æç¤º `onLogout`ã€‚

```jsx
import React from 'react';

const AuthContext = React.createContext({
  isLoggedIn: false,
  onLogout: () => {},
});

export default AuthContext;
```

### é€éè‡ªå®šç¾©çš„ Context Provider æä¾› Global ç‹€æ…‹

å¦‚æœæ˜¯ Global ç‹€æ…‹ï¼Œå…¶å¯¦å¯ä»¥æ”¾åˆ°æ›´å¤–å±¤ï¼Œä»¥ä¾¿è®“ App.js çš„ç¨‹å¼ç¢¼æ›´å–®ç´”ï¼Œä¹Ÿå°±æ˜¯å–®ç´”ç”¨ä¾†æ¸²æŸ“ Web App ä¸»é«”è€Œå·²ã€‚

åšæ³•å°±æ˜¯æˆ‘å€‘æŠŠ Context Provider å¯«åœ¨ index.js ç•¶ä¸­ï¼Œåœ¨ `ReactDOM.render` çš„æ™‚å€™å°±åŒ…è¦† Appã€‚

é€™éº¼åšå¯ä»¥æ›´é›†ä¸­ç‹€æ…‹ç®¡ç†çš„éƒ¨åˆ†ï¼Œä¹Ÿèƒ½è®“çµ„ä»¶çš„é‚è¼¯é›†ä¸­ï¼Œå°‡ä¸åŒçš„é‚è¼¯åˆ†é›¢ï¼Œç®—æ˜¯ä¸€å€‹æ»¿æ¨è–¦çš„åšæ³•ã€‚

```jsx
// index.js

export const AuthContextProvider = (props) => {
  const [isLoggedIn, setIsLoggedIn] = useState(false);

  const loginHandler = (email, password) => {
    // handle login...
  };

  const logoutHandler = () => {
    // handle logout...
  };

  return (
    <AuthContext.Provider
      value={{
        isLoggedIn: isLoggedIn,
        onLogin: loginHandler,
        onLogout: logoutHandler,
      }}
    >
      {props.children}
    </AuthContext.Provider>
  );
};
```

```jsx
ReactDOM.render(
  <AuthContextProvider>
    <App />
  </AuthContextProvider>,
  document.getElementById('root')
);
```

## Recap

çœ‹å®Œé€™ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘åˆ°åº•æœ‰ä»€éº¼æ”¶ç©«å‘¢ï¼Ÿè—‰ç”±æœ¬æ–‡å¯ä»¥ç†è§£åˆ°â€¦

- React Context
- useContext Hook

## References

- [React - The Complete Guide (incl Hooks, React Router, Redux)](https://www.udemy.com/course/react-the-complete-guide-incl-redux/)
