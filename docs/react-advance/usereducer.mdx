---
sidebar_position: 1
---

# Introducing useReducer

## âš“ useReducer Hook

> ğŸ’¡ If you have an **object** as a state or a more **complex state updates**, useReducer might be interesting.

æ›´å¼·å¤§çš„ç‹€æ…‹ç®¡ç†ï¼Œä½†ä½¿ç”¨èµ·ä¾†ä¹Ÿæ›´ç‚ºè¤‡é›œï¼Œé©åˆç”¨æ–¼è³‡æ–™æœ‰è¼ƒè¤‡é›œçš„è™•ç†æ™‚ï¼Œä½†ä¸€èˆ¬è€Œè¨€ï¼Œå¤šæ•¸æƒ…æ³ä¸‹ä½¿ç”¨ useState å°±è¶³å¤ å“©ã€‚

å¦‚æœæœ‰å­¸é Vuexï¼Œå…¶å¯¦ useReducer æœ‰è‘—é¡ä¼¼ Vuex çš„è§€å¿µï¼Œå®ƒè·Ÿ Redux æ›´æ˜¯ 87% åƒï¼Œéƒ½æ“æœ‰ Actionã€Reducerã€Store é€™å¹¾å€‹å‚³éè³‡æ–™çš„è§€å¿µã€‚

ä¸é useReducer æ²’è¾¦æ³•åƒ Vuex æˆ–æ˜¯ Redux ä¸€æ¨£å»ºç«‹èµ·å…¨å±€çš„è³‡æ–™ç‹€æ…‹ï¼Œå®ƒå»ºç«‹çš„ä»ç„¶æ˜¯ç•¶å‰ Component çš„ State è€Œå·²ï¼Œä½†æ˜¯æˆ‘å€‘é‚„æ˜¯å¯ä»¥é€éæ­é… useContext åšåˆ°é¡ä¼¼è¼•é‡ Redux çš„åŠŸèƒ½å–”ã€‚

### **ä½¿ç”¨æ–¹å¼** INIT (â‰ˆ State in Vuex)

```jsx
const [state, dispatchFn] = useReducer(reducerFn, initState, initFn);
```

- state: state snapshot
- **dispatchFn**: a function to update the state snapshot
- **reducerFn**: get the latest state snapshot automatically, and return the new updated state
- initState
- initFn

### Reducer Function (â‰ˆ Mutations in Vuex)

Reducer Function (reducerFn) å¯ä»¥ç›´æ¥ç”¨åŒ¿åç®­é ­å‡½å¼ï¼Œæˆ–æ˜¯é¡å¤–å¯«ä¸€å€‹å…·åå‡½å¼ã€‚å¦‚æœ Reducer Function æ²’æœ‰ç”¨åˆ° Component è£¡çš„ Stateï¼Œæ˜¯å¯ä»¥æŠŠå‡½å¼æ”¾åˆ° Component å¤–é¢çš„ã€‚

é€™å€‹ Reducer Function æœƒæ¥æ”¶å…©å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ˜¯ `state` èˆ‡ `action`ï¼Œä¸¦ä¸”æœ€å¾Œè¦ Return ä¸€å€‹æœ€æ–°çš„ Stateã€‚

```jsx
// State
const defaultEmailState = {
  value: '',
  isValid: false,
};
const emailReducer = (state, action) => {
  return defaultEmailState;
};

const Login = (props) => {
  const [emailState, dispatchEmail] = useReducer(
    emailReducer,
    defaultEmailState
  );
};
```

### Dispatch Function (â‰ˆ dispatch Actions in Vuex)

åœ¨å…ƒä»¶ä¸­ä½¿ç”¨ Dispatch Functionï¼Œå¾Œé¢å¸¶å…¥çš„åƒæ•¸æœƒä¸€èµ·å‚³éçµ¦ useReducer çš„ `action` åƒæ•¸ã€‚

ç¯„ä¾‹ä¸­ `emailReducer` å¯å–å¾—ç”± `dispatchEmail` æ‰€å‚³éçš„ `action.type` èˆ‡ `action.val`ã€‚

```jsx
//                     type       , payload
dispatchEmail({ type: 'USER_INPUT', val: event.target.value });
```

é€šå¸¸æˆ‘å€‘æœƒç”¨ã€Œç‰©ä»¶ã€çš„å½¢å¼ä¾†å®šç¾© `action`ï¼Œå› ç‚ºé€™æ¨£å¯ä»¥é †ä¾¿è²æ˜é€™å€‹ `action` çš„ `type`ã€‚

æ¥ä¸‹ä¾†æˆ‘å€‘å°±å¯ä»¥ä¾†æ›´æ–° state äº†ï¼

```jsx
// React guarantees that this state is absolutely the last state snapshot
const emailReducer = (state, action) => {
  // ä½¿ç”¨è€…è¼¸å…¥è§¸ç™¼ Dispatch Function
  if (action.type === 'USER_INPUT') {
    return { value: action.val, isValid: action.val.includes('@') };
  }
  // è¼¸å…¥æ¡†å¤±å»ç„¦é»è§¸ç™¼ Dispatch Function
  if (action.type === 'INPUT_BLUR') {
    return { value: state.value, isValid: state.value.includes('@') };
  }
  return { value: '', isValid: false };
};
```

## Why useReducer

åˆ°é€™è£¡ï¼Œæˆ‘å€‘å·²ç¶“æŠŠåŸæœ¬åœ¨å…ƒä»¶ä¸­çš„é‚è¼¯æŠ½é›¢åˆ° reducer è£¡é¢äº†ã€‚

é€™éº¼åšçš„å¥½è™•åœ¨æ–¼ï¼Œä¸€æ—¦å…ƒä»¶è£¡çš„ State é‚è¼¯è¤‡é›œæ™‚ï¼Œæˆ‘å€‘ä¸æœƒåœ¨é–±è®€å…ƒä»¶ç¨‹å¼ç¢¼çš„åŒæ™‚ï¼Œé‚„è¢«å„ç¨® setState æäº‚è‡ªå·±æ€ç·’ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæˆ‘å€‘è¦æŠŠ Callback ä½œç‚º Props å‚³çµ¦å­å…ƒä»¶ï¼Œé€šå¸¸éƒ½æœƒåŠ ä¸Š useCallback è¨˜æ†¶å‡½å¼ï¼Œé¿å…é‡æ–°æ¸²æŸ“ã€‚  
è€Œä½¿ç”¨ useReducer å¾Œï¼Œå› ç‚º dispatch ä¸æœƒå› çˆ² Re-rendering è€Œè¢«é‡æ–°åˆ†é…è¨˜æ†¶é«”ä½ç½®ï¼Œæ‰€ä»¥å®ƒè¢«ç•¶ä½œ Props å‚³éæ™‚ï¼Œä¸åŠ ä¸Š useMemo ä¹Ÿæ²’å•é¡Œã€‚

## ç„¡æ³•å®Œå…¨å–ä»£ Redux

é›–ç„¶ useReducer å¯ä»¥æ­é… useContext åšåˆ°é¡ä¼¼ Redux çš„ç‹€æ…‹ç®¡ç†æ©Ÿåˆ¶ï¼Œä½†æ˜¯ä»–å€‘ä»ç„¶ç„¡æ³•å–ä»£ Reduxã€‚

å› ç‚º Redux èƒ½é€é Action-Creator-Thunk é€™ç¨® Middleware ä¾†è™•ç†è³‡æ–™ä¸²æ¥ï¼Œä»¥åŠ Side Effect çš„è™•ç†ï¼Œé€™å€‹éƒ¨åˆ†å³ä½¿æ˜¯ useReducer + useContext ä¹Ÿä»ç„¶æ²’è¾¦æ³•åšåˆ°çš„ã€‚

å¦å¤–ï¼Œä½¿ç”¨ useContext æœ€å¤§çš„ç¡¬å‚·å°±æ˜¯ Re-rendering çš„å•é¡Œï¼Œä¸€æ—¦ Provider å‚³éçš„å€¼æ”¹è®Šï¼Œæ‰€æœ‰ç”¨åˆ°çš„å…ƒä»¶éƒ½æœƒé‡æ–°è¢«æ¸²æŸ“ã€‚

æ‰€ä»¥åŸºæ–¼ä»¥ä¸Šå…©é»ï¼Œä»–å€‘ç„¡æ³•å®Œå…¨å–ä»£ Reduxã€‚ä¸éå¦‚æœåªæ˜¯æƒ³è¦å°‹æ±‚ Props Drilling çš„è§£æ±ºæ–¹æ¡ˆï¼Œé‚£éº¼ useReducer åŠ ä¸Š useContext å°±æœƒæ˜¯ä¸€å€‹å¾ˆé©åˆçš„åšæ³•å“©ã€‚

## Recap

çœ‹å®Œé€™ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘åˆ°åº•æœ‰ä»€éº¼æ”¶ç©«å‘¢ï¼Ÿè—‰ç”±æœ¬æ–‡å¯ä»¥ç†è§£åˆ°â€¦

- useReducer Hook

## References

- [React - The Complete Guide (incl Hooks, React Router, Redux)](https://www.udemy.com/course/react-the-complete-guide-incl-redux/)
